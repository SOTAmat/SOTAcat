; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs    = seeed_xiao_esp32c3_debug
description     = SOTACAT: Elecraft KX CAT control with SOTAMAT, by AB6D

; Define common items for all environments
[env]
platform = espressif32 @ 6.7.0
framework = espidf
monitor_speed = 115200
monitor_raw = yes
lib_deps =
    https://github.com/jeffkowalski/esp32-smbus.git#dc95fb3  ; Pinned to specific commit for reproducibility
build_flags =
    -DAPP_VERSION=1.0.0
    -DAPP_NAME="SOTACAT"
    -DAPP_DESCRIPTION="CAT control with SOTAMAT"
; Rather than use a SPIFFS file system, we embed the web files into the binary directly.
; In the future we may update the app to use a file system such as LittleFS or SPIFFS.
; Note: Binary files (PNG, ICO) use embed_files; text files use embed_txtfiles
board_build.embed_files =
    src/web/sclogo.jpg
    src/web/favicon.ico
    src/web/index.htmlgz
    src/web/style.cssgz
    src/web/main.jsgz
    src/web/chase.htmlgz
    src/web/chase.jsgz
    src/web/chase_api.jsgz
    src/web/settings.htmlgz
    src/web/settings.jsgz
    src/web/cat.htmlgz
    src/web/cat.jsgz
    src/web/about.htmlgz
    src/web/about.jsgz

; ------------------------------------------------------------------------------------------
; ------------------------------------------------------------------------------------------
; Now define specific environments
; ------------------------------------------------------------------------------------------
; ------------------------------------------------------------------------------------------

; ------------------------------------------------------------------------------------------
; Seeed Xiao ESP32-C3 - Single Core, RISC-V, 160MHz, 4MB Flash, 320KB SRAM
; ------------------------------------------------------------------------------------------
[env:seeed_xiao_esp32c3_debug]
board = seeed_xiao_esp32c3
board_build.partitions = partition_definitions/partitions_seeed_xiao_esp32c3_ota.csv
extra_scripts = pre:pio-pre-build-script.py
;               post:pio-post-build-script.py  ; Disabled in debug - build info updated by pre-script only
build_flags =
    ${env.build_flags}
    -DSEEED_XIAO
    -DDEBUG
    -DESP_LOG_DEFAULT_LEVEL=ESP_LOG_VERBOSE
    -DSC_BUILD_TYPE=\"D\"
    -Og ; -Og is optimized for debugging
    -g ; Generate debug info and include debug symbols in the binary
build_unflags = -Os

[env:seeed_xiao_esp32c3_release]
board = seeed_xiao_esp32c3
board_build.partitions = partition_definitions/partitions_seeed_xiao_esp32c3_ota.csv
extra_scripts = pre:pio-pre-build-script.py
                post:pio-post-build-script.py
build_flags =
    ${env.build_flags}
    -DSEEED_XIAO
    -DRELEASE
    -DESP_LOG_DEFAULT_LEVEL=ESP_LOG_INFO
    -DSC_BUILD_TYPE=\"R\"
    -O3 ; Optimize: -Os optimizes for size, while -O3 optimizes for speed
